<h2>Admin Panel</h2>

<form [formGroup]="newProductForm" (ngSubmit)="addProduct()">
  <input formControlName="name" placeholder="Product name" />
  <div
    *ngIf="getControlError(newProductForm.get('name'), 'required')"
    class="error-msg"
  >
    Name is required
  </div>

  <input type="number" min="0.01" formControlName="price" placeholder="Price" />
  <div
    *ngIf="getControlError(newProductForm.get('price'), 'required')"
    class="error-msg"
  >
    Price is required
  </div>
  <div
    *ngIf="getControlError(newProductForm.get('price'), 'min')"
    class="error-msg"
  >
    Price cannot be negative or zero
  </div>

  <div
    *ngIf="getControlError(newProductForm.get('price'), 'min')"
    class="error-msg"
  >
    Price must be at least 0.01
  </div>

  <input
    type="number"
    formControlName="quantity"
    placeholder="Quantity"
    min="1"
    max="15"
  />
  <div
    *ngIf="getControlError(newProductForm.get('quantity'), 'required')"
    class="error-msg"
  >
    Quantity is required
  </div>
  <div
    *ngIf="getControlError(newProductForm.get('quantity'), 'min')"
    class="error-msg"
  >
    Quantity must be at least 1
  </div>
  <div
    *ngIf="getControlError(newProductForm.get('quantity'), 'max')"
    class="error-msg"
  >
    Quantity cannot exceed 15
  </div>

  <button type="submit" [disabled]="newProductForm.invalid">Add</button>
</form>

<ul>
  @for (product of products; track $index) {
  <li [formGroup]="productEdits[product.id]">
    <input type="text" formControlName="name" />
    <input type="number" formControlName="price" min="0.01" />
    <input type="number" formControlName="quantity" min="1" max="15" />

    <div
      *ngIf="getControlError(productEdits[product.id].get('name'), 'required')"
      class="error-msg"
    >
      Name is required
    </div>
    <div
      *ngIf="getControlError(productEdits[product.id].get('price'), 'required')"
      class="error-msg"
    >
      Price is required
    </div>
    <div
      *ngIf="getControlError(productEdits[product.id].get('price'), 'min')"
      class="error-msg"
    >
      Price must be at least 0.01
    </div>
    <div
      *ngIf="
        getControlError(productEdits[product.id].get('quantity'), 'required')
      "
      class="error-msg"
    >
      Quantity is required
    </div>
    <div
      *ngIf="getControlError(productEdits[product.id].get('quantity'), 'min')"
      class="error-msg"
    >
      Quantity must be at least 1
    </div>
    <div
      *ngIf="getControlError(productEdits[product.id].get('quantity'), 'max')"
      class="error-msg"
    >
      Quantity cannot exceed 15
    </div>

    <button
      (click)="updateProduct(product.id)"
      [disabled]="productEdits[product.id].invalid"
    >
      Update
    </button>
    <button (click)="deleteProduct(product.id)">Delete</button>
  </li>
  }
</ul>
